openapi: "3.0.0"
info:
  version: 0.0.1
  title: CardIt
servers: 
  - url: 'carditapi.hipper.world:8090'
tags:
  - name: Customer Login
    description: Login and signup Customers
  - name: Customer Actions
    description: Manage Customers
  - name: Business Login
    description: Login and signup Business
  - name: Business Actions
    description: Manage Business
  - name: Admin Actions
    description: Manage as Admin
paths:
  '/customer/login':
    post:
      tags:
        - Customer Login
      summary: Login by Email
      description: ''
      operationId: login
      requestBody:
        required: true
        content:
          'application/json':
            schema:
              $ref: '#/components/schemas/login_request'
      responses:
        '200':
          $ref: '#/components/schemas/login_response'
        '405':
          description: Invalid input
  '/customer/login/check_email':
    post:
      tags:
        - Customer Login
      summary: Check Email Address
      operationId: emailCheck
      requestBody:
        required: true
        content:
          'application/json':
            schema:
              type: object
              properties:
                email:
                  type: string
              required:
              - token
      responses:
        '405':
          description: Invalid input
  '/customer/login/signup':
    post:
      tags:
        - Customer Login
      summary: Signup by Email
      operationId: emailSignup
      requestBody:
        required: true
        content:
          'application/json':
            schema:
              $ref: '#/components/schemas/login_request'
      responses:
        '200':
          $ref: '#/components/schemas/login_response'
        '405':
          description: Invalid input
  '/customer/login/refresh':
    post:
      tags:
        - Customer Login
      summary: refresh the Customer token
      operationId: refresh token
      requestBody:
        required: true
        content:
          'application/json':
            schema:
              type: object
              properties:
                refreshToken:
                  description: refresh key of the customer
                  type: string
                email:
                  description: Customer email
                  type: string
      responses:
        '200':
          $ref: '#/components/schemas/login_response'
        '405':
          description: Invalid input
  '/customer/login/facebook':
    post:
      tags:
        - Customer Login
      summary: Login or register using a facebook token
      description: 'Use scope=public_profile,email in the requset'
      operationId: loginFacebookToken
      requestBody:
        required: true
        content:
          'application/json':
            schema:
              type: object
              properties:
                token:
                  type: string
              required:
              - token
      responses:
        '200':
          $ref: '#/components/schemas/login_response'
        '405':
          description: Invalid input
  '/customer/login/google':
    post:
      tags:
        - Customer Login
      summary: Login or register using a Google token
      description: 'Use scope=profile,email in the requset'
      operationId: loginGoogleToken
      requestBody:
        required: true
        content:
          'application/json':
            schema:
              type: object
              properties:
                token:
                  type: string
              required:
              - token
      responses:
        '200':
          $ref: '#/components/schemas/login_response'
        '405':
          description: Invalid input
  
  # -----------------------
  # Customer Actions
  # -----------------------
  '/customer/public/benefit_offer':
    get:
      tags:
        - Customer Actions
      summary: List all the benefits offered
      description: List all the benefits offered
      responses:
        '200':
          description: List of benefits offered
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/benefit_offer'
  '/customer/{id}':
    get:
      tags:
        - Customer Actions
      summary: Get the Customer data
      description: Get the Customer data
      parameters:
        - name: id
          in: path
          description: The id of the Customer
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Purchase request with code
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/customer'
  '/customer/{id}/benefit_offer':
    get:
      tags:
        - Customer Actions
      summary: List all the benefits offered to the Customer
      description: List all the benefits offered to the Customer
      parameters:
        - name: id
          in: path
          description: The id of the Customer
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of benefits offered
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/benefit_offer'
  '/customer/{id}/benefit_purchased/request':
    post:
      tags:
        - Customer Actions
      summary: Create purches request for the benefit
      description: Create purches request for the benefit
                    In the future also buy the benefit offer for Customer
      parameters:
        - name: id
          in: path
          description: The id of the Customer
          required: true
          schema:
            type: string
      requestBody:
        description: Info about the purchase
        required: true
        content:
          'application/json':
            schema:
              $ref: '#/components/schemas/benefit_purchase_request'
      responses:
        '200':
          description: Purchase request with code
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/benefit_purchase_request'
  '/customer/{id}/benefit_purchased':
    get:
      tags:
        - Customer Actions
      summary: List all the benefits the Customer purchased
      description: List all the benefits the Customer purchased
      parameters:
        - name: id
          in: path
          description: The id of the Customer
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of benefits offered
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/benefit_purchased'
  '/customer/{id}/benefit_usage/request':
    post:
      tags:
        - Customer Actions
      summary: Create use request for the purchased benefit
      description: Create use request for the purchased benefit
      parameters:
        - name: id
          in: path
          description: The id of the Customer
          required: true
          schema:
            type: string
      requestBody:
        description: Info about the usage reuest
        required: true
        content:
          'application/json':
            schema:
              $ref: '#/components/schemas/benefit_usage_request'
      responses:
        '200':
          description: Usage request with code
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/benefit_usage_request'
  '/customer/{id}/benefit_usage':
    get:
      tags:
        - Customer Actions
      summary: List benefit usage for the customer
      description: List benefit usage for the customer
      parameters:
        - name: id
          in: path
          description: The id of the Customer
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of previous benefit usage 
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/benefit_usage'              
  
  #
  # Business login
  #
  '/business/login/email':
    post:
      tags:
        - Business Login
      summary: Signup new provider
      description: Create new provider in the system
      operationId: signupProvider
      requestBody:
        description: Info about the provider location
        required: true
        content:
          'application/json':
            schema:
              $ref: '#/components/schemas/login_request'
      responses:
        '200':
          description: successful operation
  #
  # Business Actions
  #
  '/business/{businessId}/redeem':
    post:
      tags:
        - Business Actions
      summary: Redeem the benefit by the business
      description: Redeem the benefit by the business
      parameters:
        - name: businessId
          in: path
          description: The id of the business
          required: true
          schema:
            type: string
      requestBody:
        description: Uniqe identification for the benefit purchase requst
        required: true
        content:
          'application/json':
            schema:
              $ref: '#/components/schemas/benefit_purchase_request_redeem'
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/benefit_purchased'
                  - $ref: '#/components/schemas/benefit_usage'
  '/business/{businessId}/benefit_purchased':
    get:
      tags:
        - Business Actions
      summary: (Future) List all the benefit purchase requsts for the business
      description: List all the benefit purchase requsts for the business
      parameters:
        - name: businessId
          in: path
          description: The id of the business
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of Classification Categories
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/benefit_purchased'
  '/business/{businessId}/benefit_usaged':
    get:
      tags:
        - Business Actions
      summary: Get list of benefits that the business sold
      description: Get list of benefits that the business sold
                    The default is one month back and max of 100 benefits
      parameters:
        - name: businessId
          in: path
          description: The id of the business
          required: true
          schema:
            type: string
        - name: from
          in: query
          description: The starting date to get the list
          required: false
          schema:
            type: string
        - name: to
          in: query
          description: The ending date to get the list
          required: false
          schema:
            type: string
        - name: maxrec
          in: query
          description: The maximum number of record to show, defualt is 100
          required: false
          schema:
            type: number
      responses:
        '200':
          description: List of benefits offered
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/benefit_usage'
  #
  # Business Actions
  #
  '/admin/business':
    post:
      tags:
        - Admin Actions
      summary: Add business to the system
      description: Add business to the system
      parameters:
        - name: businessId
          in: path
          description: The id of the business
          required: true
          schema:
            type: string
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/business'
  '/admin/business/{businessId}':
    get:
      tags:
        - Admin Actions
      summary: Get all business info
      description: Get all business info
      parameters:
        - name: businessId
          in: path
          description: The id of the business
          required: true
          schema:
            type: string
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/business'
    post:
      tags:
        - Admin Actions
      summary: Update business info
      description: Update business info
      parameters:
        - name: businessId
          in: path
          description: The id of the business
          required: true
          schema:
            type: string
      requestBody:
        description: Uniqe identification for the benefit purchase requst
        required: true
        content:
          'application/json':
            schema:
              $ref: '#/components/schemas/business'
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/business'
  '/admin/business/{businessId}/benefit_offer':
    get:
      tags:
        - Admin Actions
      summary: Get All business benefits offered
      description: Get All business benefits offered
      parameters:
        - name: businessId
          in: path
          description: The id of the business
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of benefits offered
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/benefit_offer'
    post:
      tags:
        - Admin Actions
      summary: Add benefit offered to business
      description: Add benefit offered to business
      parameters:
        - name: businessId
          in: path
          description: The id of the business
          required: true
          schema:
            type: string
      requestBody:
        description: Uniqe identification for the benefit purchase requst
        required: true
        content:
          'application/json':
            schema:
              $ref: '#/components/schemas/benefit_offer'
      responses:
        '200':
          description: The created benefits offer
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/benefit_offer'
  '/admin/business/{businessId}/benefit_offer/{offerId}':
    get:
      tags:
        - Admin Actions
      summary: Get business offered benefit
      description: Get business offered benefit
      parameters:
        - name: businessId
          in: path
          description: The id of the business
          required: true
          schema:
            type: string
        - name: offerId
          in: path
          description: The id of the business
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of benefits offered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/benefit_offer'
    post:
      tags:
        - Admin Actions
      summary: Update business offered benefit
      description: Update business offered benefit
      parameters:
        - name: businessId
          in: path
          description: The id of the business
          required: true
          schema:
            type: string
        - name: offerId
          in: path
          description: The id of the business
          required: true
          schema:
            type: string
      requestBody:
        description: Uniqe identification for the benefit purchase requst
        required: true
        content:
          'application/json':
            schema:
              $ref: '#/components/schemas/benefit_offer'
      responses:
        '200':
          description: List of benefits offered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/benefit_offer'
    delete:
      tags:
        - Admin Actions
      summary: Update business offered benefit
      description: Update business offered benefit
      parameters:
        - name: businessId
          in: path
          description: The id of the business
          required: true
          schema:
            type: string
        - name: offerId
          in: path
          description: The id of the business
          required: true
          schema:
            type: string
      responses:
        '200':
          description: List of benefits offered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/benefit_offer'
# securityDefinitions:
#  petstore_auth:
#    type: oauth2
#    authorizationUrl: 'http://petstore.swagger.io/oauth/dialog'
#    flow: implicit
#    scopes:
#      'write:pets': modify pets in your account
#      'read:pets': read your pets
#  api_key:
#    type: apiKey
#    name: api_key
#    in: header 
components:
  responses:
    ByteImage:
      description: Image
      content:
        image/png:
          schema:
            type: string
            format: binary
    NotFound:
      description: The specified resource was not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/error'
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/error'
    
  schemas:
    login_request:
      type: object
      properties:
        email:
          type: string
        password:
          type: string
    
    login_response:
      type: object
      properties:
        access_token:
          type: string
        refresh_token:
          type: string
        scope:
          type: string
        token_type:
          type: string
        expires_in:
          type: number
        customer_id:
          type: string
        provider_id:
          type: string

    address:
      type: object
      properties:
        adress1:
          type: string
        address2:
          type: string
        district:
          type: string
        city:
          type: string
        country:
          type: string
        postalCode:
          type: string
        phone:
          type: string
        location:
          $ref: '#/components/schemas/location'
    location:
      type: object
      properties:
        x:
          type: number
          format: dubble
        y:
          type: number
          format: dubble
    
    customer:
      type: object
      properties:
        id:
          type: string
        email:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        gender:
          type: string
          enum: [male, female]
        birthDate:
          type: string
          format: date-time
          
    business:
      type: object
      properties:
        email:
          type: string
        name:
          type: string
        address:
          $ref: '#/components/schemas/address'
        information:
          $ref: '#/components/schemas/businessInformation'
          
    businessInformation:
      type: object
      properties:
        contactName:
          type: string
        decription:
          type: string
        picture_url:
          type: string
        facebook_url:
          type: string
        
    benefit_type:
      description: Unique code for the request
      type: string
      enum: [free, prepaid]
      
    benefit_offer:
      type: object
      properties:
        id:
          type: string
        businessId:
          type: string
        type:
          $ref: '#/components/schemas/benefit_type'
        validFrom:
          type: string
          format: date-time
        validTo:
          type: string
          format: date-time
        description:
          type: string
        price:
          type: number
        points:
          type: number
      required:
        - type
        - validFrom
        - validTo
        - price
        - description
    
    benefit_purchase_request:
      type: object
      properties:
        benefit_offer_id:
          description: the ID of the business the benefit belongs to
          type: string
        businessId:
          description: the ID of the business the benefit belongs to
          type: string
        CustomerId:
          description: the ID of the business the benefit belongs to
          type: string
        code:
          $ref: '#/components/schemas/benefit_code'
        requestTime:
          description: The time the request was sent
          type: string
          format: date-time
      required:
        - businessId
        - code
        - requestTime
        
    benefit_code:
      description: Returned by the server for new Customer requests,
                    Send by the business for confirmation
      type: string
    
    benefit_purchase_request_redeem:
      type: object
      properties:
        code:
          $ref: '#/components/schemas/benefit_code'
        redeemTime:
          type: string
          format: date-time
      required:
      - code
      - redeemTime
    
    benefit_purchased:
      type: object
      properties:
        id:
          description: The offered benefit id
          type: string
        benefit_purchased_id:
          description: The origin benefit purchased id
          type: string
        type:
          $ref: '#/components/schemas/benefit_type'
        code:
          $ref: '#/components/schemas/benefit_code'
        name:
          type: string
        businessName:
          type: string
        pictureURL:
          type: string
        price:
          type: number
    
    benefit_usage_request:
      type: object
      description: The Customer gets this object, And the business can query it
      properties:
        id:
          description: The usage request id
          type: string
        benefit_purchased_id:
          description: The origin benefit purchased id
          type: string
        businessId:
          description: the ID of the business the benefit belongs to
          type: string
        CustomerId:
          description: the ID of the customer requesting
          type: string
        points:
          description: The point to reduce
                        Required only for points type
          type: number
        # Only returned can not set by the Customer
        code:
          $ref: '#/components/schemas/benefit_code'
        requestTime:
          type: string
          format: date-time
          
    benefit_usage:
      type: object
      properties:
        id:
          description: The benefit usage id
          type: string
        benefit_purchased_id:
          description: The origin benefit purchased id
          type: string
        businessId:
          description: the ID of the business the benefit belongs to
          type: string
        CustomerId:
          description: the ID of the customer requesting
          type: string
        points_used:
          type: number
        points_left:
          type: number
    
    benefit_used_request_redeem:
      type: object
      description: Only the business sending this object
      properties:
        code:
          $ref: '#/components/schemas/benefit_code'
        redeemTime:
          type: string
          format: date-time
      required:
      - code
      - redeemTime
    
    error:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
    file_base64:
      type: object
      properties:
        base64:
          description: File representation in base64
          type: string
        hight:
          type: integer
          format: int64
        width:
          type: integer
          format: int64
        name:
          type: string
